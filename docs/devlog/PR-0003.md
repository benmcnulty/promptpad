## PR #0003: Pre-flight optimization of plans, agents, prompts (contracts frozen, gpt-oss:20b)
- Branch: docs/preflight-codex-optimization@codex
- Author/Agent: codex
- Scope: docs
- Summary: Performed a high-rigor pre-flight pass to freeze API/patch contracts across all agent docs, add JSON Schema invalid examples and edge cases, clarify Live Dev UX expectations, harmonize coverage targets, and add review artifacts for gaps and accepted optimizations.

### Touched Areas
- AIDEVOPS.md (added Contracts & Schemas, Live Dev UX Contract)
- AGENTS.md, CLAUDE.md, .github/copilot-instructions.md (added identical Contracts sections)
- docs/plan/20-pr-sequence.md (PR #2 DoD includes StatusBar + non-blank shell)
- docs/plan/30-test-strategy.md (coverage harmonized to ≥80%; Mock Ollama; Patch fixtures)
- docs/agents/schemas/api-contract.schema.json (invalidExamples added)
- docs/agents/schemas/patch.schema.json (CRLF/Unicode example + invalidExamples)
- docs/review/gap_analysis.md (new)
- docs/review/optimizations.md (new)
- CHANGELOG.md (Unreleased updated)

### Test Evidence (docs-only PR)
```bash
# Sanity checks (manual validation in this docs-only PR)
grep -R "Contracts (Frozen)" -n AGENTS.md CLAUDE.md .github/copilot-instructions.md | wc -l

jq . docs/agents/schemas/api-contract.schema.json >/dev/null && echo OK
jq . docs/agents/schemas/patch.schema.json >/dev/null && echo OK

# Coverage thresholds harmonized to ≥80%
grep -n "Target Coverage:** 80%" docs/plan/30-test-strategy.md | wc -l
grep -n "Required Thresholds" -n docs/plan/30-test-strategy.md
grep -n "lib/diff.ts": docs/plan/30-test-strategy.md
```

### Risks & Mitigations
- Risk: Over-constraining coverage could slow velocity → Mitigation: keep ≥80% as gate; allow stretch targets per-PR.
- Risk: Schema examples misinterpreted as code → Mitigation: clearly labeled as examples; invalidExamples assist reviewers.

### Follow-ups
- Add CI jobs to validate docs schemas against sample fixtures when codebase exists.
- Implement StatusBar in PR #2 scaffold (UI) with placeholders.

### Reviewer Focus Areas
- Confirm contract shapes are identical across AIDEVOPS, AGENTS, CLAUDE, Copilot docs.
- Verify Test Strategy updates align with AIDEVOPS gates (≥80% for core libs).
- Review schema invalidExamples for clarity and completeness.

