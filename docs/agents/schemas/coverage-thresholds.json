{
  "description": "Test coverage thresholds for Promptpad MVP core libraries",
  "version": "1.0.0",
  "lastUpdated": "2024-08-09",
  
  "global": {
    "lines": 70,
    "branches": 65,
    "functions": 70,
    "statements": 70
  },

  "perFile": {
    "lib/diff.ts": {
      "lines": 80,
      "branches": 80,
      "functions": 85,
      "statements": 80,
      "reason": "Core algorithm - requires comprehensive edge case coverage"
    },
    "lib/history.ts": {
      "lines": 80, 
      "branches": 80,
      "functions": 85,
      "statements": 80,
      "reason": "Data persistence and undo/redo - critical for user experience"
    },
    "lib/tokens/index.ts": {
      "lines": 80,
      "branches": 75,
      "functions": 80,
      "statements": 80,
      "reason": "Token counting interface - must handle all edge cases"
    },
    "lib/tokens/tiktoken.ts": {
      "lines": 80,
      "branches": 75, 
      "functions": 80,
      "statements": 80,
      "reason": "Default tokenizer implementation - performance critical"
    },
    "app/api/models/route.ts": {
      "lines": 90,
      "branches": 85,
      "functions": 90,
      "statements": 90,
      "reason": "API contract compliance - must handle all scenarios"
    },
    "app/api/refine/route.ts": {
      "lines": 90,
      "branches": 85,
      "functions": 90, 
      "statements": 90,
      "reason": "Core API endpoint - comprehensive error handling required"
    },
    "lib/ollama.ts": {
      "lines": 75,
      "branches": 80,
      "functions": 80,
      "statements": 75,
      "reason": "External service integration - focus on error scenarios"
    }
  },

  "exclusions": [
    "**/*.test.ts",
    "**/*.spec.ts", 
    "__tests__/**/*",
    "**/*.d.ts",
    "next.config.js",
    "tailwind.config.js",
    "jest.config.js"
  ],

  "componentThresholds": {
    "components/**/*.tsx": {
      "lines": 60,
      "branches": 55,
      "functions": 65,
      "statements": 60,
      "reason": "UI components - focus on integration over unit coverage"
    },
    "hooks/**/*.ts": {
      "lines": 75,
      "branches": 70,
      "functions": 80,
      "statements": 75,
      "reason": "React hooks - important for state management"
    },
    "pages/**/*.tsx": {
      "lines": 50,
      "branches": 45,
      "functions": 55,
      "statements": 50,
      "reason": "Page components - mostly integration tested"
    }
  },

  "enforcement": {
    "failOnThresholdViolation": true,
    "requirePerFileThresholds": true,
    "allowLowerGlobalIfPerFilesMet": true,
    "warningThreshold": 5,
    "errorThreshold": 10
  },

  "reportingConfig": {
    "formats": ["text", "json", "html", "lcov"],
    "outputDirectory": "coverage/",
    "summaryReports": true,
    "detailedReports": true,
    "uncoveredLines": true
  },

  "testCommands": {
    "unit": "pnpm test --coverage",
    "integration": "pnpm test:integration --coverage",
    "specific": "pnpm test {{file}} --coverage",
    "threshold-check": "pnpm test --coverage --coverageThreshold='@/coverage-thresholds.json'"
  },

  "notes": {
    "coreLibraryFocus": "lib/diff.ts, lib/history.ts, lib/tokens/* require ≥80% coverage due to algorithmic complexity and edge cases",
    "apiEndpointFocus": "API routes require ≥90% coverage for contract compliance and error handling", 
    "componentStrategy": "UI components focus on integration testing rather than unit test coverage",
    "performanceConsideration": "Test execution should complete in <30s for full suite",
    "edgeCasePriority": "CRLF handling, Unicode support, empty inputs, localStorage limits must be covered"
  },

  "coverageGates": {
    "pullRequest": {
      "requiresThresholds": true,
      "allowTemporaryDecrease": false,
      "maxDecrease": 2,
      "requiresJustification": true
    },
    "mergeQueue": {
      "blockOnFailure": true,
      "requiresApproval": false,
      "notificationLevel": "error"
    }
  }
}